<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 å‡ºç”Ÿç‚¹åæ ‡æ‹¾å–å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label {
            font-size: 14px;
            color: #aaa;
        }

        select {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #3a3a5a;
            background: #2a2a4a;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        .team-btns {
            display: flex;
            gap: 8px;
        }

        .team-btn {
            padding: 8px 20px;
            border-radius: 8px;
            border: 2px solid #555;
            background: transparent;
            color: #888;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .team-btn.ct.active {
            border-color: #4facfe;
            color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
        }

        .team-btn.t.active {
            border-color: #f5a623;
            color: #f5a623;
            background: rgba(245, 166, 35, 0.1);
        }

        .team-btn:hover {
            opacity: 0.8;
        }

        .map-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .map-wrapper {
            position: relative;
            background: #0a0a1a;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        #mapImage {
            display: block;
            width: 800px;
            height: 800px;
            cursor: crosshair;
            transition: none;
            transform-origin: center center;
            user-select: none;
            -webkit-user-drag: none;
        }

        .map-wrapper.dragging #mapImage {
            cursor: grabbing;
        }

        .map-inner {
            position: relative;
            display: inline-block;
        }

        .zoom-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 10;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .zoom-btn:hover {
            background: rgba(79, 172, 254, 0.8);
        }

        .zoom-level {
            text-align: center;
            font-size: 12px;
            color: #aaa;
            background: rgba(0, 0, 0, 0.5);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .spawn-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
            /* ä½¿ç”¨ transform-origin ç¡®ä¿ä»ä¸­å¿ƒç¼©æ”¾ */
            transform-origin: center center;
        }

        .spawn-marker:hover {
            opacity: 0.8;
        }

        .spawn-marker.ct {
            background: rgba(79, 172, 254, 0.9);
        }

        .spawn-marker.t {
            background: rgba(245, 166, 35, 0.9);
        }

        .sidebar {
            background: rgba(30, 30, 50, 0.9);
            border-radius: 12px;
            padding: 20px;
            min-width: 300px;
            max-height: 600px;
            overflow-y: auto;
        }

        .sidebar h3 {
            margin-bottom: 15px;
            font-size: 16px;
            color: #4facfe;
        }

        .spawn-list {
            list-style: none;
        }

        .spawn-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 13px;
        }

        .spawn-item .coords {
            color: #888;
            font-family: monospace;
        }

        .spawn-item .delete-btn {
            background: #e74c3c;
            border: none;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .spawn-item .delete-btn:hover {
            background: #c0392b;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: #000;
        }

        .btn-danger {
            background: #e74c3c;
            color: #fff;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .code-output {
            margin-top: 20px;
            background: #0a0a1a;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            color: #4facfe;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: #27ae60;
            color: #fff;
            border-radius: 8px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
        }

        .tip {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¯ CS2 å‡ºç”Ÿç‚¹åæ ‡æ‹¾å–å·¥å…·</h1>

        <div class="controls">
            <div class="control-group">
                <label>åœ°å›¾:</label>
                <select id="mapSelect">
                    <option value="mirage">Mirage</option>
                    <option value="dust2">Dust2</option>
                    <option value="inferno">Inferno</option>
                    <option value="anubis">Anubis</option>
                    <option value="ancient">Ancient</option>
                    <option value="nuke_upper">Nuke (ä¸Šå±‚)</option>
                    <option value="nuke_lower">Nuke (ä¸‹å±‚)</option>
                    <option value="overpass">Overpass</option>
                    <option value="vertigo_upper">Vertigo (ä¸Šå±‚)</option>
                    <option value="vertigo_lower">Vertigo (ä¸‹å±‚)</option>
                    <option value="train">Train</option>
                </select>
            </div>
            <div class="control-group">
                <label>é˜µè¥:</label>
                <div class="team-btns">
                    <button class="team-btn ct active" data-team="ct">CT</button>
                    <button class="team-btn t" data-team="t">T</button>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div class="map-wrapper" id="mapWrapper">
                <div class="map-inner" id="mapInner">
                    <img id="mapImage" src="../assets/maps/mirage.png" alt="Map">
                    <div id="markersContainer"></div>
                </div>
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()" title="æ”¾å¤§">+</button>
                    <div class="zoom-level" id="zoomLevel">100%</div>
                    <button class="zoom-btn" onclick="zoomOut()" title="ç¼©å°">âˆ’</button>
                    <button class="zoom-btn" onclick="resetZoom()" title="é‡ç½®" style="font-size:14px;">â†º</button>
                </div>
            </div>

            <div class="sidebar">
                <h3>ğŸ“ å·²æ·»åŠ çš„å‡ºç”Ÿç‚¹</h3>
                <div id="ctList">
                    <h4 style="color:#4facfe;margin:10px 0 5px;font-size:13px;">CT å‡ºç”Ÿç‚¹</h4>
                    <ul class="spawn-list" id="ctSpawnList"></ul>
                </div>
                <div id="tList">
                    <h4 style="color:#f5a623;margin:10px 0 5px;font-size:13px;">T å‡ºç”Ÿç‚¹</h4>
                    <ul class="spawn-list" id="tSpawnList"></ul>
                </div>

                <div class="actions">
                    <button class="btn btn-primary" onclick="copyDartCode()">ğŸ“‹ å¤åˆ¶ Dart ä»£ç </button>
                    <button class="btn btn-danger" onclick="clearCurrentMap()">ğŸ—‘ï¸ æ¸…ç©ºå½“å‰åœ°å›¾</button>
                </div>

                <div class="code-output" id="codeOutput">// é€‰æ‹©åœ°å›¾å¹¶æ·»åŠ å‡ºç”Ÿç‚¹åï¼Œä»£ç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
            </div>
        </div>
        <p class="tip">ğŸ’¡ å·¦é”®ç‚¹å‡»æ·»åŠ å‡ºç”Ÿç‚¹ | å³é”®æ‹–æ‹½ç§»åŠ¨åœ°å›¾ | æ»šè½®ç¼©æ”¾ | æ•°æ®è‡ªåŠ¨ä¿å­˜</p>
    </div>

    <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

    <script>
        // æ•°æ®å­˜å‚¨ - ä» localStorage åŠ è½½
        const STORAGE_KEY = 'cs2_spawn_points';
        let spawnData = loadFromStorage();
        let currentMap = 'mirage';
        let currentTeam = 'ct';
        let currentZoom = 1;
        let panX = 0, panY = 0;
        const minZoom = 0.5;
        const maxZoom = 5;

        // æ‹–æ‹½çŠ¶æ€
        let isDragging = false;
        let dragStartX = 0, dragStartY = 0;
        let dragStartPanX = 0, dragStartPanY = 0;

        // ä¿å­˜åˆ° localStorage
        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(spawnData));
        }

        // ä» localStorage åŠ è½½
        function loadFromStorage() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        // ç¼©æ”¾å’Œå¹³ç§»åŠŸèƒ½
        const mapInner = document.getElementById('mapInner');
        const mapWrapper = document.getElementById('mapWrapper');

        function updateTransform() {
            mapInner.style.transform = `translate(${panX}px, ${panY}px) scale(${currentZoom})`;
            document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
        }

        function zoomIn() {
            currentZoom = Math.min(maxZoom, currentZoom + 0.25);
            updateTransform();
            updateMarkerScale();
        }

        function zoomOut() {
            currentZoom = Math.max(minZoom, currentZoom - 0.25);
            updateTransform();
            updateMarkerScale();
        }

        function resetZoom() {
            currentZoom = 1;
            panX = 0;
            panY = 0;
            updateTransform();
            updateMarkerScale();
        }

        // æ»šè½®ç¼©æ”¾
        mapWrapper.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        });

        // å³é”®æ‹–æ‹½å¹³ç§»
        mapWrapper.addEventListener('mousedown', (e) => {
            if (e.button === 2) { // å³é”®
                e.preventDefault();
                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                dragStartPanX = panX;
                dragStartPanY = panY;
                mapWrapper.classList.add('dragging');
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                panX = dragStartPanX + (e.clientX - dragStartX);
                panY = dragStartPanY + (e.clientY - dragStartY);
                updateTransform();
            }
        });

        document.addEventListener('mouseup', (e) => {
            if (e.button === 2 && isDragging) {
                isDragging = false;
                mapWrapper.classList.remove('dragging');
            }
        });

        // ç¦æ­¢å³é”®èœå•
        mapWrapper.addEventListener('contextmenu', (e) => e.preventDefault());

        // åˆå§‹åŒ–åœ°å›¾æ•°æ®
        function initMapData(mapName) {
            if (!spawnData[mapName]) {
                spawnData[mapName] = { ct: [], t: [] };
            }
        }

        // DOM å…ƒç´ 
        const mapSelect = document.getElementById('mapSelect');
        const mapImage = document.getElementById('mapImage');
        const markersContainer = document.getElementById('markersContainer');
        const ctSpawnList = document.getElementById('ctSpawnList');
        const tSpawnList = document.getElementById('tSpawnList');
        const codeOutput = document.getElementById('codeOutput');
        const teamBtns = document.querySelectorAll('.team-btn');

        // åˆ‡æ¢åœ°å›¾
        mapSelect.addEventListener('change', (e) => {
            currentMap = e.target.value;
            mapImage.src = `../assets/maps/${currentMap}.png`;
            initMapData(currentMap);
            renderAll();
        });

        // åˆ‡æ¢é˜µè¥
        teamBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                teamBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTeam = btn.dataset.team;
            });
        });

        // ç‚¹å‡»åœ°å›¾æ·»åŠ å‡ºç”Ÿç‚¹
        mapImage.addEventListener('click', (e) => {
            // è·å– mapWrapper çš„è¾¹ç•Œï¼ˆä½œä¸ºè§†å£å‚è€ƒï¼‰
            const wrapperRect = mapWrapper.getBoundingClientRect();

            // è·å–å›¾ç‰‡çš„åŸå§‹å°ºå¯¸ï¼ˆCSS å®šä¹‰çš„ 800x800ï¼‰
            const imageWidth = 800;
            const imageHeight = 800;

            // è®¡ç®—å›¾ç‰‡ä¸­å¿ƒåœ¨ wrapper ä¸­çš„ä½ç½®
            // mapInner çš„ transform-origin æ˜¯ center centerï¼Œæ‰€ä»¥ç¼©æ”¾ä»¥ (400, 400) ä¸ºä¸­å¿ƒ
            const imageCenterX = wrapperRect.left + wrapperRect.width / 2 + panX;
            const imageCenterY = wrapperRect.top + wrapperRect.height / 2 + panY;

            // è®¡ç®—ç¼©æ”¾åå›¾ç‰‡çš„å·¦ä¸Šè§’ä½ç½®
            const scaledWidth = imageWidth * currentZoom;
            const scaledHeight = imageHeight * currentZoom;
            const imageLeft = imageCenterX - scaledWidth / 2;
            const imageTop = imageCenterY - scaledHeight / 2;

            // è®¡ç®—ç‚¹å‡»ä½ç½®ç›¸å¯¹äºå›¾ç‰‡å·¦ä¸Šè§’çš„åç§»ï¼ˆåœ¨ç¼©æ”¾åçš„åæ ‡ç³»ä¸­ï¼‰
            const clickOffsetX = e.clientX - imageLeft;
            const clickOffsetY = e.clientY - imageTop;

            // è½¬æ¢ä¸ºåŸå§‹å›¾ç‰‡åæ ‡çš„ç™¾åˆ†æ¯”
            const x = clickOffsetX / scaledWidth;
            const y = clickOffsetY / scaledHeight;

            initMapData(currentMap);
            const spawns = spawnData[currentMap][currentTeam];
            const id = spawns.length + 1;

            spawns.push({ id, x: parseFloat(x.toFixed(4)), y: parseFloat(y.toFixed(4)) });
            renderAll();
        });

        // åˆ é™¤å‡ºç”Ÿç‚¹
        function deleteSpawn(team, index) {
            spawnData[currentMap][team].splice(index, 1);
            // é‡æ–°ç¼–å·
            spawnData[currentMap][team].forEach((s, i) => s.id = i + 1);
            renderAll();
        }

        // æ¸²æŸ“æ ‡è®°
        function renderMarkers() {
            markersContainer.innerHTML = '';
            initMapData(currentMap);

            ['ct', 't'].forEach(team => {
                spawnData[currentMap][team].forEach((spawn, index) => {
                    const marker = document.createElement('div');
                    marker.className = `spawn-marker ${team}`;
                    marker.style.left = `${spawn.x * 100}%`;
                    marker.style.top = `${spawn.y * 100}%`;
                    // åå‘ç¼©æ”¾ä¿æŒè§†è§‰å¤§å°ä¸€è‡´ï¼Œå¹¶å±…ä¸­å®šä½
                    const scale = 1 / currentZoom;
                    marker.style.transform = `translate(-50%, -50%) scale(${scale})`;
                    marker.textContent = spawn.id;
                    marker.title = `${team.toUpperCase()}-${spawn.id} (${spawn.x}, ${spawn.y}) - ç‚¹å‡»åˆ é™¤`;
                    marker.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteSpawn(team, index);
                    });
                    markersContainer.appendChild(marker);
                });
            });
        }

        // æ›´æ–°æ ‡è®°ç¼©æ”¾ï¼ˆç¼©æ”¾æ—¶è°ƒç”¨ï¼‰
        function updateMarkerScale() {
            const scale = 1 / currentZoom;
            document.querySelectorAll('.spawn-marker').forEach(marker => {
                marker.style.transform = `translate(-50%, -50%) scale(${scale})`;
            });
        }

        // æ¸²æŸ“åˆ—è¡¨
        function renderLists() {
            initMapData(currentMap);

            ctSpawnList.innerHTML = spawnData[currentMap].ct.map((s, i) => `
                <li class="spawn-item">
                    <span>CT-${s.id}</span>
                    <span class="coords">(${s.x}, ${s.y})</span>
                    <button class="delete-btn" onclick="deleteSpawn('ct', ${i})">åˆ é™¤</button>
                </li>
            `).join('') || '<li style="color:#555;font-size:12px;">æš‚æ— </li>';

            tSpawnList.innerHTML = spawnData[currentMap].t.map((s, i) => `
                <li class="spawn-item">
                    <span>T-${s.id}</span>
                    <span class="coords">(${s.x}, ${s.y})</span>
                    <button class="delete-btn" onclick="deleteSpawn('t', ${i})">åˆ é™¤</button>
                </li>
            `).join('') || '<li style="color:#555;font-size:12px;">æš‚æ— </li>';
        }

        // ç”Ÿæˆ Dart ä»£ç 
        function generateDartCode() {
            initMapData(currentMap);
            const data = spawnData[currentMap];

            const ctCode = data.ct.map(s => `SpawnPoint(${s.id}, ${s.x}, ${s.y})`).join(', ');
            const tCode = data.t.map(s => `SpawnPoint(${s.id}, ${s.x}, ${s.y})`).join(', ');

            return `'${currentMap}': MapSpawnConfig(
  ctSpawns: [${ctCode}],
  tSpawns: [${tCode}],
),`;
        }

        // æ¸²æŸ“ä»£ç è¾“å‡º
        function renderCode() {
            codeOutput.textContent = generateDartCode();
        }

        // æ¸²æŸ“å…¨éƒ¨å¹¶è‡ªåŠ¨ä¿å­˜
        function renderAll() {
            renderMarkers();
            renderLists();
            renderCode();
            saveToStorage(); // è‡ªåŠ¨ä¿å­˜åˆ° localStorage
        }

        // å¤åˆ¶ Dart ä»£ç 
        function copyDartCode() {
            const code = generateDartCode();
            navigator.clipboard.writeText(code).then(() => {
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }

        // æ¸…ç©ºå½“å‰åœ°å›¾
        function clearCurrentMap() {
            if (confirm(`ç¡®å®šè¦æ¸…ç©º ${currentMap} çš„æ‰€æœ‰å‡ºç”Ÿç‚¹å—ï¼Ÿ`)) {
                spawnData[currentMap] = { ct: [], t: [] };
                renderAll();
            }
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // åˆå§‹åŒ–
        initMapData(currentMap);
        renderAll();
    </script>
</body>

</html>